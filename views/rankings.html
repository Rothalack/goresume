{{define "head"}}

{{end}}

{{define "content"}}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ml-32 mr-32">
        <div class="col-span-2 p-8 bg-gray-800 shadow rounded">
            <div id="guild-info" class="space-y-4"></div>
            <div id="guild-form" class="max-w-sm mx-auto">
                <div class="mb-5">
                    <label for="guild" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Guild Name</label>
                    <input type="text" id="guild" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="COZY" required />
                </div>
                <div class="mb-5">
                    <label for="guildRegion" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Select Region</label>
                    <select id="guildRegion" onchange="fetchServers()" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                        <option value="">Select Region</option>
                    </select>
                </div>
                <div class="mb-5">
                    <label for="guildServer" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Select Server:</label>
                    <select id="guildServer" name="guildServer" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                        <option value="">Select Server</option>
                    </select>
                </div>
                <button id="find-guild" class="text-white bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-gray-600 dark:hover:bg-gray-700 dark:focus:ring-blue-800">Find Guild</button>
            </div>
        </div>
        <div class="col-span-2 p-8 bg-gray-800 shadow rounded">
            <h2 class="text-2xl mt-2 mb-5">Characters</h2>
            <div id="characters" class="space-y-4"></div>
            <div class="max-w-sm mx-auto mt-5">
                <div class="mb-5">
                    <label for="character-name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Character Name</label>
                    <input type="text" id="character-name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Frothy" value="" required />
                </div>
                <button id="add-character" class="text-white bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-gray-600 dark:hover:bg-gray-700 dark:focus:ring-blue-800">Find Character</button>
            </div>
        </div>
    </div>
    <script>
        fetchRegions();
        function fetchRegions() {
            fetch(`/api/find-regions`)
                .then(response => response.json())
                .then(resp => {
                    const regions = resp.data.regions;
                    renderRegionsDropdown(regions);
                })
                .catch(err => console.error('Error fetching regions: ', err))
        }
        function renderRegionsDropdown(regions){
            const dropdown = document.getElementById('guildRegion');
            regions.forEach((region) => {
                const option = document.createElement('option');
                option.value = region.slug
                option.setAttribute('data-region-id', region.id)
                option.textContent = region.slug
                dropdown.appendChild(option);
            });
        }

        function fetchServers(){
            const dropdown = document.getElementById('guildRegion');
            const selectedOption = dropdown.options[dropdown.selectedIndex];

            const regionId = selectedOption.getAttribute('data-region-id');
            const regionSlug = selectedOption.value;

            fetch(`/api/find-server?regionId=${regionId}`)
                .then(response => response.json())
                .then(data => {
                    const servers = data.data;
                    renderServersDropdown(servers, regionSlug);
                })
                .catch(err => console.error('Error fetching servers: ', err));
        }
        function renderServersDropdown(servers, regionSlug) {
            const dropdown = document.getElementById('guildServer');

            dropdown.innerHTML = '<option value="">Select Server</option>';

            servers.forEach((server) => {
                const option = document.createElement('option');
                option.value = server.slug;
                option.textContent = server.name;
                dropdown.appendChild(option);
            });
        }
        // Find guild
        document.getElementById('find-guild').addEventListener('click', function () {
            const guildName = document.getElementById('guild').value;
            const guildRegion = document.getElementById('guildRegion').value;
            const guildServer = document.getElementById('guildServer').value;

            fetch(`/api/find-guild?guild=${guildName}&guildServer=${guildServer}&guildRegion=${guildRegion}`)
                .then(response => response.json())
                .then(data => {
                    const guildInfo = document.getElementById('guild-info');
                    guildInfo.classList.remove('hidden');
                    guildInfo.className = 'p-4 bg-gray-900 rounded shadow text-white';
                    guildInfo.innerHTML = `
                        <h3 class="text-2xl font-bold">${data.guildName}</h3>
                        <p>Region: ${data.region}</p>
                        <p>Realm: ${data.realm}</p>
                    `;
                })
                .catch(err => console.error('Error fetching guild:', err));

            const guildForm = document.getElementById('guild-form');
            guildForm.style.display = 'none';
        });

        document.getElementById('add-character').addEventListener('click', async (event) => {
            event.preventDefault();

            const input = document.getElementById('character-name');
            const characterName = input.value.trim();

            if (!characterName) {
                alert('Please enter a character name.');
                return;
            }

            try {
                // Simulate fetching character data from an API
                const response = await fetch('/api/add-character', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `character=${characterName}`,
                })
                if (!response.ok) {
                    throw new Error(`Failed to fetch character data for ${characterName}`);
                }

                const data = await response.json();

                // Create a new div for the character display
                const characterDiv = document.createElement('div');
                characterDiv.className = 'p-4 bg-gray-900 rounded shadow text-white';
                characterDiv.innerHTML = `
                    <h3 class="text-2xl font-bold">${data.name}</h3>
                    <p>Level: ${data.level}</p>
                    <p>Class: ${data.class}</p>
                    <p>Guild: ${data.guild}</p>
                `;

                // Append the new character div
                document.getElementById('characters').appendChild(characterDiv);

                // Clear the input field
                input.value = '';
            } catch (error) {
                console.error(error);
                alert('Error fetching character data. Please try again.');
            }
        });
    </script>
{{end}}

<!-- <div class="mb-5">
    <label for="game" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Select Game</label>
    <select id="game" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
        <option>The War Within</option>
        <option>Classic Cataclysm</option>
        <option>Classic Wrath of the Lich King</option>
        <option>Classic Burning Crusade</option>
        <option>Classic Vanilla</option>
        <option>Classic Fresh</option>
        <option>Season of Discovery</option>
        <option>Classic Era</option>
        <option>Hardcore</option>
    </select>
</div> -->